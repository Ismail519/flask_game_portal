{% extends 'base.html' %}

{% block content %}
{{ super() }}

{% for cat, msg in get_flashed_messages(True) %}
<div class="flash {{cat}}">{{msg}}</div>
{% endfor %}

<div class="search-container">
    <h1 class="page-title">{{title}}</h1>
    <form method="get" action="{{ url_for('listgames') }}">
        <div class="search-controls">
            <div class="search-container">
                <input type="text" name="search" id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é..." value="{{ request.args.get('search', '') }}">
                <button type="submit" id="search-btn">üîç</button>
            </div>
            <div class="sort-container">
                <label for="sort-select">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é:</label>
                <select id="sort-select" name="sort_name">
                    <option value="title_asc" {% if sort == 'title_asc' %}selected{% endif %}>–ù–∞–∑–≤–∞–Ω–∏–µ (–ê-–Ø)</option>
                    <option value="title_desc" {% if sort == 'title_desc' %}selected{% endif %}>–ù–∞–∑–≤–∞–Ω–∏–µ (–Ø-–ê)</option>
                    <option value="time_asc" {% if sort == 'time_asc' %}selected{% endif %}>–î–∞—Ç–∞ (—Å—Ç–∞—Ä—ã–µ —Å–Ω–∞—á–∞–ª–∞)</option>
                    <option value="time_desc" {% if sort == 'time_desc' %}selected{% endif %}>–î–∞—Ç–∞ (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)</option>
                </select>
            </div>
            <div class="filter-container">
                <label>–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É:</label>
                <select id="type-filter" name="type_filter">
                    <option value="" {% if not filter_type %}selected{% endif %}>–í—Å–µ</option>
                    <option value="link" {% if filter_type == 'link' %}selected{% endif %}>–í–Ω–µ—à–Ω—è—è —Å—Å—ã–ª–∫–∞</option>
                    <option value="pygame" {% if filter_type == 'pygame' %}selected{% endif %}>Pygame</option>
                    <option value="unity" {% if filter_type == 'unity' %}selected{% endif %}>Unity</option>
                </select>
                <label>–§–∏–ª—å—Ç—Ä –ø–æ –∂–∞–Ω—Ä—É:</label>
                <select id="genre-filter" name="genre_filter">
                    <option value="" {% if not filter_genre %}selected{% endif %}>–í—Å–µ</option>
                    {% for genre in genres %}
                        <option value="{{ genre }}" {% if filter_genre == genre %}selected{% endif %}>{{ genre }}</option>
                    {% endfor %}
                </select>
                <label>–§–∏–ª—å—Ç—Ä –ø–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–º—É:</label>
                <select id="favorite-filter" name="favorite_filter">
                    <option value="" {% if not filter_favorite %}selected{% endif %}>–í—Å–µ</option>
                    <option value="favorite" {% if filter_favorite == 'favorite' %}selected{% endif %}>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ</option>
                </select>
            </div>
            <button type="submit" id="apply-filters-btn" class="btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </div>
    </form>
</div>

<div class="cards-container">
    {% for game in games %}
    <div class="game-card-container">
        <a href="{{ url_for('game', game_id=game.id) }}" class="game-card">
            {% if game.cover %}
            <div class="game-cover">
                <img src="data:image/jpeg;base64,{{ game.cover|b64encode }}" alt="{{ game.title }}">
            </div>
            {% endif %}
            <div class="game-title">
                <div class="game-name">{{ game.title }}</div>
                <div class="game-type">
                    {% if game.type == 'link' %}
                        <img src="{{ url_for('static', filename='images/type/web.png') }}" alt="Web" class="type-icon">
                        <span>Web</span>
                    {% elif game.type == 'pygame' %}
                        <img src="{{ url_for('static', filename='images/type/pygame.png') }}" alt="Pygame" class="type-icon">
                        <span>Pygame</span>
                    {% elif game.type == 'unity' %}
                        <img src="{{ url_for('static', filename='images/type/unity.png') }}" alt="Unity" class="type-icon">
                        <span>Unity</span>
                    {% endif %}
                </div>
                {% if game.genre %}
                <div class="game-genre">{{ game.genre }}</div>
                {% endif %}
            </div>
        </a>
        <button class="favorite-btn" data-game-id="{{ game.id }}" data-is-favorite="{{ 'true' if game.id in favorite_game_ids else 'false' }}">
            {% if game.id in favorite_game_ids %}
                <span class="favorite-icon">‚òÖ</span> –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
            {% else %}
                <span class="favorite-icon">‚òÜ</span> –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
            {% endif %}
        </button>
    </div>
    {% endfor %}
</div>

<script src="{{ url_for('static', filename='js/favorites.js') }}"></script>
{% endblock %}
